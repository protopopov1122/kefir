SECTION .text

extern __kefirrt_nop_impl
extern __kefirrt_jmp_impl
extern __kefirrt_branch_impl
extern __kefirrt_push_impl
extern __kefirrt_pop_impl
extern __kefirrt_pick_impl
extern __kefirrt_put_impl
extern __kefirrt_insert_impl
extern __kefirrt_xchg_impl
extern __kefirrt_drop_impl
extern __kefirrt_iadd_impl
extern __kefirrt_iadd1_impl
extern __kefirrt_isub_impl
extern __kefirrt_imul_impl
extern __kefirrt_idiv_impl
extern __kefirrt_imod_impl
extern __kefirrt_ineg_impl
extern __kefirrt_inot_impl
extern __kefirrt_iand_impl
extern __kefirrt_ior_impl
extern __kefirrt_ixor_impl
extern __kefirrt_ishr_impl
extern __kefirrt_isar_impl
extern __kefirrt_ishl_impl
extern __kefirrt_iequals_impl
extern __kefirrt_igreater_impl
extern __kefirrt_ilesser_impl
extern __kefirrt_iabove_impl
extern __kefirrt_ibelow_impl
extern __kefirrt_band_impl
extern __kefirrt_bor_impl
extern __kefirrt_bnot_impl
extern __kefirrt_trunc1_impl
extern __kefirrt_extend8_impl
extern __kefirrt_extend16_impl
extern __kefirrt_extend32_impl
extern __kefirrt_offsetptr_impl
extern __kefirrt_elementptr_impl
extern __kefirrt_load8u_impl
extern __kefirrt_load8i_impl
extern __kefirrt_load16u_impl
extern __kefirrt_load16i_impl
extern __kefirrt_load24u_impl
extern __kefirrt_load32u_impl
extern __kefirrt_load32i_impl
extern __kefirrt_load40u_impl
extern __kefirrt_load48u_impl
extern __kefirrt_load56u_impl
extern __kefirrt_load64_impl
extern __kefirrt_store8_impl
extern __kefirrt_store16_impl
extern __kefirrt_store24_impl
extern __kefirrt_store32_impl
extern __kefirrt_store40_impl
extern __kefirrt_store48_impl
extern __kefirrt_store56_impl
extern __kefirrt_store64_impl
extern __kefirrt_bzero_impl
extern __kefirrt_bcopy_impl
extern __kefirrt_extubits_impl
extern __kefirrt_extsbits_impl
extern __kefirrt_insertbits_impl
extern __kefirrt_getlocals_impl
extern __kefirrt_f32add_impl
extern __kefirrt_f32sub_impl
extern __kefirrt_f32mul_impl
extern __kefirrt_f32div_impl
extern __kefirrt_f32neg_impl
extern __kefirrt_f64add_impl
extern __kefirrt_f64sub_impl
extern __kefirrt_f64mul_impl
extern __kefirrt_f64div_impl
extern __kefirrt_f64neg_impl
extern __kefirrt_f32equals_impl
extern __kefirrt_f32greater_impl
extern __kefirrt_f32lesser_impl
extern __kefirrt_f64equals_impl
extern __kefirrt_f64greater_impl
extern __kefirrt_f64lesser_impl
extern __kefirrt_f32cint_impl
extern __kefirrt_f64cint_impl
extern __kefirrt_intcf32_impl
extern __kefirrt_intcf64_impl
extern __kefirrt_uintcf32_impl
extern __kefirrt_uintcf64_impl
extern __kefirrt_f32cf64_impl
extern __kefirrt_f64cf32_impl
extern __kefirrt_alloca_impl
extern __kefirrt_preserve_state
extern __kefirrt_restore_state
extern __kefirrt_save_registers
extern __kefirrt_load_integer_vararg
extern __kefirrt_load_sse_vararg
extern __kefirrt_copy_vararg

extern func2
extern func3

global func1

func1:
    call __kefirrt_preserve_state
    sub rsp, 16
    mov r14, rsp
    lea r12, [r14 - 8]
    push r12
    mov rbx, __func1_body
    jmp [rbx]
__func1_body:
    dq __kefirrt_sfunction_func2_gate1, 0
    dq __kefirrt_sfunction_func3_gate2, 0
    dq __func1_epilogue, 0
__func1_epilogue:
    mov rsp, r14
    add rsp, 16
    jmp __kefirrt_restore_state

__kefirrt_sfunction_func2_gate1:
    mov r12, rsp
    and rsp, -16
    mov rdi, [r12 + 16]
    pinsrq xmm0, [r12 + 8], 0
    mov rsi, [r12 + 0]
    call func2
    mov rsp, r12
    add rsp, 24
    push rax
    add rbx, 16
    jmp [rbx]

__kefirrt_sfunction_func3_gate2:
    mov r12, rsp
    and rsp, -16
    pinsrq xmm0, [r12 + 16], 0
    mov rdi, [r12 + 8]
    pinsrq xmm1, [r12 + 0], 0
    call func3
    mov rsp, r12
    add rsp, 24
    pextrq r11, xmm0, 0
    push r11
    add rbx, 16
    jmp [rbx]
